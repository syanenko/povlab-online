<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4BTQWYDYSB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4BTQWYDYSB');
    </script>

    <title>POV-Lab</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="expires" content="timestamp">
    <link type="text/css" rel="stylesheet" href="/index.css">
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
  </head>

  <body>
  <!-- Header --> 
  <div id='header'></div>
  <!-- Insert header -->
  <script>
    fetch("/header.html")
      .then(response => {
        return response.text()
      }).then(data => {
        document.getElementById('header').innerHTML = data;
      });

    function showAbout()
    {
      document.getElementById("about").showModal();
    }
  </script>

  <img id='result' alt="Image" style='visibility: hidden; z-index:2;'>

  <form id="form_upload_code" encType="multipart/form-data" style="text-align:left">
    <textarea id="editor" wrap="off">
    </textarea>
  </form>

  <script>
    var form = document.getElementById('form_upload_code');
    form.addEventListener('submit', function(e) {
      e.preventDefault();

      var formData = new FormData();
      const editor  = document.getElementById("editor")
      const blob = new Blob([editor.value], { type: "text/plain" });
      formData.append("scene", blob, 'scene.pov');

      var xhr = new XMLHttpRequest();
      // Check before deploy !
      // xhr.open('POST', 'http://localhost:8083/render/render.php');
      xhr.open('POST', 'https://povlab.online/render/render.php');

      xhr.responseType = 'json';
      xhr.onload = function() {
        if (xhr.status === 200) {
          let result = document.getElementById("result");
          result.src = "https://povlab.online/render/" + xhr.response;
          console.log(xhr.response);
          result.style.visibility = 'visible';
        } else {
          console.error(xhr.response);
        }
      }
      xhr.send(formData);
    });

    // Send by 'Ctrl-S'
    document.addEventListener("keydown", function keydown (event) {
        if (navigator.platform === "MacIntel" ? event.metaKey : event.ctrlKey && event.key === "s") {
            event.preventDefault()
            document.getElementById("form_upload_code").requestSubmit();
        }
    })

    document.getElementById("form_upload_code").requestSubmit();
  </script>

  <!-- Rendering container
  <div id="container" style='height: 100vh; width: 100%; position: absolute; z-index:-1'></div>
  -->

  <!-- Video
  <video id="video" style='transform: translate(-50%, -50%);  position: absolute;  top: 50%; left: 50%; display:none; object-fit: fill;' playsinline></video>
  -->
  <video id="video" playsinline></video>
  <input id="video_button" type="image" src="./data/icons/outline_videocam_white_48dp.png" style='z-index:2'/>
  <script>
    vb = document.getElementById("video_button");
    vb.onmouseenter = function () {
      vb.style.opacity = '1.0';
    };

    vb.onmouseleave = function () {
      vb.style.opacity = '0.5';
    };
  </script>
 
  <input id="gallery_button" type="image" src="./data/icons/grid_view_FILL0_wght500_GRAD0_opsz48.png", style='z-index:2'/>
  <script>
    gb = document.getElementById("gallery_button");
    gb.onmouseenter = function () {
      gb.style.opacity = '1.0';
    };

    gb.onmouseleave = function () {
      gb.style.opacity = '0.5';
    };

    gb.onclick = function () {
      window.location = "https://povlab.online";
    };
  </script>

  <input id="upload_button" type="image" src="./data/icons/outline_file_upload_white_48dp.png", style='z-index:2'/>
  <script>
    ub = document.getElementById("upload_button");
    ub.onmouseenter = function () {
      ub.style.opacity = '1.0';
    };

    ub.onmouseleave = function () {
      ub.style.opacity = '0.5';
    };
    
    ub.onclick = function() {
        document.getElementById("form_upload_code").requestSubmit();
    }
  </script>

  <script type="module" src="index.js"></script>

  <!-- Menu -->
  <div id="scenes">
    <button onclick="loadScene('balls.pov')">1</button>
    <button onclick="loadScene('balls_01.pov')">2</button>
    <button onclick="loadScene('balls_02.pov')">3</button>
    <button onclick="loadScene('balls_03.pov')">4</button>
    <button onclick="loadScene('head.pov')">5</button>
    <button onclick="loadScene('sugar_sphere.pov')">6</button>
    <button onclick="loadScene('1TQN/1TQN_POV_scene.pov')">7</button>
  </div>

 <script>

   function loadScene(url) {
  
   url = "https://povlab.online/render/scenes/samples/" + url;

const options = {
  headers: {
  }
};

fetch(url, options)
  .then(function(response) {
    response.text().then(function(text) {
      const editor  = document.getElementById("editor");
      editor.value = text;
      document.getElementById("form_upload_code").requestSubmit();  
    });
  });
    }

  loadScene('balls.pov')
 </script>

  </body>
</html>
